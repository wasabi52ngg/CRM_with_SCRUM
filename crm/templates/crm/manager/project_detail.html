{% extends 'crm/base.html' %}
{% block title %}Проект — {{ object.name }}{% endblock %}
{% block content %}
<h1 class="page-title">{{ object.name }}</h1>
<p class="muted">{{ object.description }}</p>

<div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
  <h2>Задачи</h2>
  <a class="btn" href="{% url 'crm:kanban_board' object.pk %}">Открыть доску</a>
</div>
<table>
    <thead>
    <tr>
      <th>Название</th>
      <th>Тип</th>
      <th>Статус</th>
      <th>Постановщик</th>
      <th>Исполнитель</th>
      <th>Дедлайн</th>
      <th>SP</th>
    </tr>
    </thead>
    <tbody>
    {% for t in object.tasks.all %}
        <tr>
            <td>{{ t.title }}</td>
            <td>{{ t.get_task_type_display }}</td>
            <td>{{ t.get_status_display }}</td>
            <td>{{ t.created_by|default:"—" }}</td>
            <td>{{ t.assignee|default:"—" }}</td>
            <td>{{ t.due_date|date:"d.m.Y"|default:"—" }}</td>
            <td>{{ t.story_points }}</td>
        </tr>
    {% empty %}
        <tr><td colspan="7">Пока нет задач</td></tr>
    {% endfor %}
    </tbody>
 </table>

<div style="margin-top:10px;">
  <span class="muted">Фишки на будущее:</span>
  <span class="muted">шаблоны задач по типу проекта, приоритет, чеклист подзадач, вложения, оценка + авто-дедлайн, зависимости между задачами и уведомления исполнителю.</span>
</div>

<h3>Добавить задачу</h3>
<form method="post">
    {% csrf_token %}
    <input type="text" name="title" placeholder="Название" required>
    <br>
    <textarea name="description" placeholder="Описание"></textarea>
    <br>
    <label class="muted" style="display:block;margin:8px 0 4px;">Исполнитель (опционально)</label>
    <select name="assignee">
      <option value="">— не назначать —</option>
      {% for u in developers %}
        <option value="{{ u.id }}">
          {{ u.username }}{% if u.developer_type %} ({{ u.get_developer_type_display }}){% endif %}
        </option>
      {% endfor %}
    </select>
    <br>
    <label class="muted" style="display:block;margin:8px 0 4px;">Дедлайн</label>
    <input type="date" name="due_date">
    <br>
    <label class="muted" style="display:block;margin:8px 0 4px;">Story points</label>
    <input type="number" name="story_points" min="0" max="100" value="0">
    <br>
    <select name="task_type" required>
        <option value="frontend">Фронтенд</option>
        <option value="backend">Бэкенд</option>
        <option value="fullstack">Фулстек</option>
        <option value="devops">DevOps</option>
        <option value="qa">Тестирование</option>
        <option value="android">Android</option>
        <option value="db">База данных</option>
    </select>
    <br>
    <button type="submit">Создать</button>
 </form>

{% endblock %}

